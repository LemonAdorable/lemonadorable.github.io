---
import type { MarkdownHeading } from 'astro'
import config from 'virtual:config'

import { TOC } from 'astro-pure/components/pages'
import PageLayout from '@/layouts/ContentLayout.astro'
import { Giscus } from '@/components/giscus'
import { PageInfo } from '@/components/waline'

interface Props {
  title: string
  headings?: MarkdownHeading[]
  view?: boolean
  comment?: boolean
  hideTitle?: boolean
  hideBack?: boolean
  mainClass?: string
  sidebarClass?: string
}

const {
  title,
  headings,
  view,
  comment: enableComment,
  hideTitle = false,
  hideBack = false,
  mainClass,
  sidebarClass,
  ...props
} = Astro.props

// Get current page slug from URL (reserved for future use)
// const currentSlug = Astro.url.pathname.replace(/^\//, '').replace(/\/$/, '') || undefined
---

<PageLayout
  meta={{ title }}
  hideBack={hideBack}
  mainClass={mainClass}
  sidebarClass={sidebarClass}
  {...props}
>
  {headings?.length && <TOC headings={headings} slot='sidebar' />}

  {
    !hideTitle && (
      <Fragment slot='header'>
        <h1 class='text-2xl font-medium sm:mb-2 sm:text-3xl'>{title}</h1>
        {(view || enableComment) && <PageInfo {view} comment={enableComment} class='italic' />}
      </Fragment>
    )
  }

  <slot />

  <slot name='bottom' slot='bottom'>
    {enableComment && config.integ.giscus?.enable && <Giscus class='mt-3 sm:mt-6' />}
  </slot>

  <slot name='bottom-sidebar' slot='bottom-sidebar' />
</PageLayout>
