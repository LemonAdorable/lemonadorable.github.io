name: Sync to Blog Repository

on:
  push:
    branches:
      - diy
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
   
      - name: Force push to destination
        env:
          # 确认这里引用的名字和网页后台一模一样
          DEPLOYTOLEMON: ${{ secrets.DEPLOYTOLEMON }} 
        run: |
            # 1. 打印一行日志确认变量不是空的（注意：GitHub 会自动隐藏 Token 内容，不用担心泄露）
              if [ -z "$DEPLOYTOLEMON" ]; then
                echo "错误：DEPLOYTOLEMON 这个 Secret 在本仓库中找不到！"
              exit 1
            fi
  
            # 2. 直接执行推送，不通过 remote 代理
            git push "https://x-access-token:${DEPLOYTOLEMON}@github.com/LemonAdorable/lemonadorable.github.io.git" diy:master --force
